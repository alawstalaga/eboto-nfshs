<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>E-Boto | NFSHS</title>
<link rel="icon" href="https://i.imgur.com/4Qb8s7v.png">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box;font-family:'Segoe UI',Arial,sans-serif;}
body{margin:0;background:#f2f2f2;}
header{background:#0054a6;color:#fff;padding:15px;text-align:center;font-size:22px;font-weight:600;}
.container{max-width:450px;background:#fff;margin:50px auto;padding:30px;border-radius:15px;box-shadow:0 4px 10px rgba(0,0,0,0.1);}
h2{text-align:center;margin-bottom:25px;}
input,select,button{width:100%;padding:10px;margin:8px 0;border:1px solid #ccc;border-radius:8px;}
button{background:#0054a6;color:#fff;border:none;cursor:pointer;font-weight:600;}
button:hover{background:#003e7d;}
.hidden{display:none;}
footer{text-align:center;margin-top:40px;color:#777;font-size:14px;}
a{text-decoration:none;}
canvas{max-width:100%;}
</style>
</head>
<body>

<header>E-Boto | NFSHS</header>

<div class="container" id="loginContainer">
  <h2>Student Login</h2>
  <input type="text" id="loginLRN" placeholder="Enter LRN (12 digits)">
  <input type="password" id="loginPass" placeholder="Enter Password">
  <button onclick="login()">Login</button>
  <button style="background:#00b4d8;" onclick="showAdminLogin()">Admin Access</button>
  <p style="margin-top:10px;font-size:14px;">
    <a href="#" onclick="forgotPassword()" style="color:#0054a6;">Forgot Password?</a>
  </p>
</div>

<div class="container hidden" id="voteContainer">
  <h2>Vote Your Candidate</h2>
  <select id="candidateSelect">
    <option value="">Select Candidate</option>
    <option value="Maria Santos">Maria Santos â€“ Grade 12 STEM</option>
    <option value="John Cruz">John Cruz â€“ Grade 12 HUMSS</option>
    <option value="Ana Dela Rosa">Ana Dela Rosa â€“ Grade 11 TVL</option>
    <option value="Carlo Mendoza">Carlo Mendoza â€“ Grade 11 ABM</option>
    <option value="Louise Tan">Louise Tan â€“ Grade 12 GAS</option>
    <option value="Mark Dizon">Mark Dizon â€“ Grade 11 ICT</option>
  </select>
  <button onclick="vote()">Submit Vote</button>
  <button style="background:#777;" onclick="logout()">Logout</button>
</div>

<div class="container hidden" id="adminContainer">
  <h2>Admin Dashboard</h2>
  <canvas id="resultsChart"></canvas>
  <button onclick="renderChart()">View Chart</button>
  <button onclick="exportResults()">Export Results</button>
  <button style="background:#777;" onclick="logout()">Logout</button>
</div>

<footer>Â© 2025 NFSHS | E-Boto System</footer>

<script>
let users = JSON.parse(localStorage.getItem('users')) || [
  {lrn:'202500000001',pass:'student1',voted:false},
  {lrn:'202500000002',pass:'student2',voted:false},
  {lrn:'202500000003',pass:'student3',voted:false},
  {lrn:'202500000004',pass:'student4',voted:false},
  {lrn:'202500000005',pass:'student5',voted:false},
  {lrn:'202500000006',pass:'student6',voted:false},
  {lrn:'202500000007',pass:'student7',voted:false},
  {lrn:'202500000008',pass:'student8',voted:false},
  {lrn:'202500000009',pass:'student9',voted:false},
  {lrn:'202500000010',pass:'student10',voted:false}
];
let votes = JSON.parse(localStorage.getItem('votes')) || {};
let admin = {user:'admin',pass:'admin123'};
let currentUser = null;

function login(){
  const lrn = document.getElementById('loginLRN').value.trim();
  const pass = document.getElementById('loginPass').value.trim();
  if(lrn===''||pass==='')return alert('Please fill in all fields.');
  if(lrn.length!==12)return alert('LRN must be 12 digits.');
  const user = users.find(u=>u.lrn===lrn && u.pass===pass);
  if(!user)return alert('Invalid LRN or password.');
  currentUser = user;
  if(user.voted){
    alert('You already voted.');
    return;
  }
  document.getElementById('loginContainer').classList.add('hidden');
  document.getElementById('voteContainer').classList.remove('hidden');
}

function vote(){
  const candidate = document.getElementById('candidateSelect').value;
  if(candidate==='')return alert('Please select a candidate.');
  votes[candidate]=(votes[candidate]||0)+1;
  localStorage.setItem('votes',JSON.stringify(votes));
  currentUser.voted=true;
  localStorage.setItem('users',JSON.stringify(users));
  alert('Vote submitted successfully!');
  logout();
}

function logout(){
  currentUser=null;
  document.getElementById('loginContainer').classList.remove('hidden');
  document.getElementById('voteContainer').classList.add('hidden');
  document.getElementById('adminContainer').classList.add('hidden');
}

function showAdminLogin(){
  const user = prompt('Enter admin username:');
  const pass = prompt('Enter admin password:');
  if(user===admin.user && pass===admin.pass){
    document.getElementById('loginContainer').classList.add('hidden');
    document.getElementById('adminContainer').classList.remove('hidden');
    renderChart();
  }else{
    alert('Invalid admin credentials.');
  }
}

function renderChart(){
  const ctx=document.getElementById('resultsChart');
  if(!ctx)return;
  const labels=Object.keys(votes);
  const data=Object.values(votes);
  new Chart(ctx,{
    type:'bar',
    data:{labels:labels,datasets:[{label:'Votes',data:data,backgroundColor:'#0054a6',borderWidth:1}]},
    options:{scales:{y:{beginAtZero:true}}}
  });
}

function exportResults(){
  let text='Candidate,Votes\n';
  for(let c in votes){text+=`${c},${votes[c]}\n`;}
  const blob=new Blob([text],{type:'text/csv'});
  const link=document.createElement('a');
  link.href=URL.createObjectURL(blob);
  link.download='results.csv';
  link.click();
}

/* ðŸ”¹ Forgot Password Feature */
function forgotPassword() { 
  const lrn = prompt("Enter your 12-digit LRN to reset your password:");
  if (!lrn) return;
  if (lrn.length !== 12) return alert("LRN must be 12 digits!");

  const user = users.find(u => u.lrn === lrn);
  if (!user) return alert("No account found with that LRN.");

  const newPass = prompt("Enter your new password:");
  if (!newPass) return alert("Password reset cancelled.");

  user.pass = newPass;
  localStorage.setItem('users', JSON.stringify(users));
  alert("Password successfully reset! You can now log in with your new password.");
}
</script>
</body>
</html>
